<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title }} | {{ site.title }}</title>
    {% if site.description %}
    <meta name="description" content="{{ site.description }}" />
    {% endif %}
    <style>
      :root {
        --bg: #0b0e11;
        --fg: #e6e6e6;
        --muted: rgba(255,255,255,.65);
        --nav-bg: #111519;
        --accent: #00ff9c;
        --border: rgba(255,255,255,.08);
      }

      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Courier New", Courier, monospace;
        background: var(--bg);
        color: var(--fg);
        line-height: 1.6;
      }

      a { color: inherit; }

      .topbar {
        background: var(--nav-bg);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .topbar-inner {
        max-width: 1100px;
        margin: 0 auto;
        padding: 16px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
      }

      .brand {
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: .5px;
        text-decoration: none;
      }

      .nav {
        display: flex;
        gap: 18px;
        flex-wrap: wrap;
        font-weight: 600;
      }

      .nav a {
        text-decoration: none;
        color: var(--muted);
        padding: 6px 8px;
        border-radius: 8px;
        transition: color .15s ease, background .15s ease;
      }

      .nav a:hover {
        color: var(--fg);
        background: rgba(255,255,255,.06);
      }

      .nav a.active {
        color: var(--accent);
      }

      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        padding: 24px 20px 60px;
      }

      .post-layout {
        display: grid;
        grid-template-columns: 180px minmax(0, 1fr);
        gap: 28px;
        align-items: start;
      }

      .post-toc {
        position: sticky;
        top: 84px;
        align-self: start;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 10px;
        background: rgba(255,255,255,.02);
        text-align: left;
        max-height: calc(100vh - 104px);
        overflow: auto;
      }

      .toc-title {
        font-weight: 700;
        margin-bottom: 8px;
        font-size: 0.95rem;
        letter-spacing: .3px;
      }

      .toc-links {
        display: flex;
        flex-direction: column;
        gap: 8px;
        font-size: 0.92rem;
      }

      .toc-links a {
        text-decoration: none;
        color: var(--muted);
        padding: 4px 6px;
        border-radius: 6px;
      }

      .toc-links a:hover {
        color: var(--accent);
        background: rgba(0,255,156,.08);
      }

      .toc-links a.active {
        color: var(--accent);
        background: rgba(0,255,156,.12);
      }

      .post-section {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px 16px 8px;
        margin: 18px 0 22px;
        background: rgba(255,255,255,.02);
      }

      .post h2,
      .post h3 {
        scroll-margin-top: 90px;
      }

      .post-section video,
      .post-section iframe,
      .post-section img {
        display: block;
        width: 100%;
        max-width: 900px;
        margin: 14px auto 6px;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: rgba(255,255,255,.02);
      }

      .demo-video-card {
        margin: 18px auto 8px;
        max-width: 900px;
        border: 1px solid var(--border);
        border-radius: 14px;
        background: rgba(255,255,255,.03);
        overflow: hidden;
      }

      .demo-video-label {
        margin: 0;
        padding: 12px 14px;
        font-weight: 700;
        color: #dfffee;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(90deg, rgba(0,255,156,.16), rgba(0,255,156,.04));
      }

      .demo-video-card a {
        display: block;
        text-decoration: none;
        aspect-ratio: 16 / 9;
        background: #000;
      }

      .demo-video-card img {
        width: 100%;
        height: 100%;
        max-width: none;
        margin: 0;
        border: 0;
        border-radius: 0;
        object-fit: cover;
        object-position: center;
        transition: transform .2s ease, filter .2s ease;
      }

      .demo-video-card a:hover img {
        transform: scale(1.01);
        filter: brightness(1.04);
      }

      .post-section > :first-child {
        margin-top: 0;
      }

      pre {
        background: rgba(0, 0, 0, 0.55);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 12px 14px;
        overflow-x: auto;
      }

      code {
        color: #e9fdf5;
      }

      @media (max-width: 900px) {
        .post-layout {
          grid-template-columns: 1fr;
        }
        .post-toc {
          position: static;
        }
      }

      @media (min-width: 1200px) {
        .post-toc {
          margin-left: calc((100vw - 1100px) / -2);
        }
      }

      .glossary-term {
        position: relative;
        border-bottom: 1px dotted rgba(0, 255, 156, 0.7);
        cursor: help;
      }

      .glossary-term::after {
        content: attr(data-tip);
        position: absolute;
        left: 0;
        bottom: 125%;
        min-width: 220px;
        max-width: 340px;
        background: #0f1418;
        color: var(--fg);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 12px;
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.4;
        box-shadow: 0 10px 30px rgba(0,0,0,.35);
        opacity: 0;
        pointer-events: none;
        transform: translateY(6px);
        transition: opacity .15s ease, transform .15s ease;
        z-index: 20;
      }

      .glossary-term:hover::after {
        opacity: 1;
        transform: translateY(0);
      }

      body.quiz-open {
        overflow: hidden;
      }

      .quiz-overlay[hidden] {
        display: none;
      }

      .quiz-overlay {
        position: fixed;
        inset: 0;
        z-index: 5000;
        background: rgba(0, 0, 0, 0.72);
        display: grid;
        place-items: center;
        padding: 18px;
      }

      .quiz-card {
        width: min(720px, 100%);
        border: 1px solid var(--border);
        border-radius: 14px;
        background: #10161b;
        box-shadow: 0 20px 50px rgba(0,0,0,.45);
        overflow: hidden;
      }

      .quiz-head {
        padding: 14px 16px;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(90deg, rgba(0,255,156,.18), rgba(0,255,156,.06));
        font-weight: 700;
      }

      .quiz-body {
        padding: 16px;
      }

      .quiz-progress {
        color: var(--muted);
        font-size: .92rem;
        margin-bottom: 8px;
      }

      .quiz-question {
        font-size: 1.1rem;
        margin: 0 0 12px;
      }

      .quiz-options {
        display: grid;
        gap: 10px;
      }

      .quiz-option-btn {
        width: 100%;
        text-align: left;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,.03);
        color: var(--fg);
        cursor: pointer;
        font: inherit;
      }

      .quiz-option-btn:hover {
        border-color: rgba(0,255,156,.35);
        background: rgba(0,255,156,.08);
      }

      .quiz-feedback {
        margin-top: 10px;
        min-height: 1.2em;
        font-weight: 700;
      }

      .quiz-feedback.ok {
        color: #85f6b8;
      }

      .quiz-feedback.bad {
        color: #ff8f8f;
      }

      .quiz-done {
        margin-top: 12px;
      }

      @media (max-width: 640px) {
        .topbar-inner {
          flex-direction: column;
          align-items: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-inner">
        <a class="brand" href="{{ '/' | relative_url }}">{{ site.title }}</a>
        <nav class="nav">
          <a href="{{ '/' | relative_url }}" class="{% if page.url == '/' %}active{% endif %}">Home</a>
          <a href="https://github.com/redsnw/redsnw.github.io" class="">Github</a>
          <a href="{{ '/termlista/' | relative_url }}" class="{% if page.url contains '/termlista' %}active{% endif %}">Termlista</a>
        </nav>
      </div>
    </header>
    <main class="wrap">
      {{ content }}
    </main>
    {% if page.title == "Introduktion till Linux terminal och filsystem i Ubuntu" %}
    <div id="linux-quiz-overlay" class="quiz-overlay" hidden>
      <div class="quiz-card" role="dialog" aria-modal="true" aria-labelledby="linux-quiz-title">
        <div id="linux-quiz-title" class="quiz-head">Quiz: Linux-labben</div>
        <div class="quiz-body">
          <div id="linux-quiz-progress" class="quiz-progress"></div>
          <p id="linux-quiz-question" class="quiz-question"></p>
          <div id="linux-quiz-options" class="quiz-options"></div>
          <div id="linux-quiz-feedback" class="quiz-feedback" aria-live="polite"></div>
          <div id="linux-quiz-done" class="quiz-done" hidden>
            <button id="linux-quiz-close" class="quiz-option-btn">Stäng quiz</button>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
    <meta name="glossary-link" content="enabled" />
    <script>
      (function () {
        var post = document.querySelector(".post");
        if (!post) return;

        var glossary = [
          { term: "FakeCaptcha", def: "En phishingmetod som lurar användaren att själv köra skadlig kod via falsk CAPTCHA.", pattern: "\\bFakeCaptcha\\b", slug: "fakecaptcha" },
          { term: "phishing", def: "Angrepp där angripare lurar användare att göra något farligt eller lämna ut info.", pattern: "\\bphishing\\b", slug: "phishing" },
          { term: "CAPTCHA", def: "Test som ska skilja människor från botar, ofta missbrukat i bluffar.", pattern: "\\bCAPTCHA\\b", slug: "captcha-recaptcha" },
          { term: "reCAPTCHA", def: "Test som ska skilja människor från botar, ofta missbrukat i bluffar.", pattern: "\\breCAPTCHA\\b", slug: "captcha-recaptcha" },
          { term: "PowerShell", def: "Windows-kommandoskal och skriptspråk som ofta utnyttjas i attacker.", pattern: "\\bPowerShell\\b", slug: "powershell" },
          { term: "mshta.exe", def: "Windows-program som kan köra HTML/skript och används ibland som \"living-off-the-land\".", pattern: "mshta\\.exe", slug: "mshta-exe" },
          { term: "Win+R", def: "Windows‑dialog för att köra kommandon snabbt.", pattern: "Win\\+R", slug: "run-win-r" },
          { term: "Run", def: "Windows‑dialog för att köra kommandon snabbt.", pattern: "\\bRun\\b", slug: "run-win-r" },
          { term: "clipboard", def: "Temporärt minne för kopierad text, som kan fyllas med skadliga kommandon.", pattern: "\\bclipboard\\b", slug: "clipboard-urklipp" },
          { term: "Malvertising", def: "Skadlig annonsering som leder till bluff- eller malware-sidor.", pattern: "\\bmalvertising\\b", slug: "malvertising" },
          { term: "SEO-poisoning", def: "Manipulation av sökresultat för att få skadliga sidor att ranka högt.", pattern: "SEO-?poisoning", slug: "seo-poisoning" },
          { term: "redirects", def: "Omdirigeringar som skickar dig vidare till en annan, ofta skadlig, sida.", pattern: "\\bredirects\\b", slug: "redirects" },
          { term: "EDR", def: "Endpoint Detection and Response, verktyg som upptäcker och stoppar attacker på klienter.", pattern: "\\bEDR\\b", slug: "edr" },
          { term: "LOLBins", def: "\"Living-off-the-land\"‑verktyg i OS som missbrukas av angripare.", pattern: "\\bLOLBins\\b", slug: "lolbins" },
          { term: "-EncodedCommand", def: "PowerShell‑flagga för att köra kod i kodad form, vanligt i attacker.", pattern: "-EncodedCommand", slug: "encodedcommand" },
          { term: "-WindowStyle Hidden", def: "PowerShell‑flagga som kör kommandon dolt utan fönster.", pattern: "-WindowStyle\\s+Hidden", slug: "windowstyle-hidden" },
          { term: "MFA", def: "Multifaktorautentisering, extra steg ut över lösenord.", pattern: "\\bMFA\\b", slug: "mfa" },
          { term: "Punycode", def: "Tekniker som gör falska domäner svåra att skilja från riktiga.", pattern: "\\bPunycode\\b", slug: "punycode-idn-homoglyfer" },
          { term: "IDN", def: "Tekniker som gör falska domäner svåra att skilja från riktiga.", pattern: "\\bIDN\\b", slug: "punycode-idn-homoglyfer" },
          { term: "stealer", def: "Malware som stjäl inloggningar, cookies eller annan data.", pattern: "\\bstealer(s)?\\b", slug: "stealer" },
          { term: "RAT", def: "Remote Access Trojan, ger angriparen fjärrkontroll över datorn.", pattern: "\\bRAT\\b", slug: "rat" },
          { term: "malware", def: "Skadlig kod som infekterar system.", pattern: "\\bmalware\\b", slug: "malware" },
          { term: "crypto mining", def: "Missbruk av din dator för att utvinna kryptovaluta.", pattern: "crypto\\s+mining", slug: "crypto-mining" },
          { term: "Ubuntu", def: "Linuxdistribution som ofta används för utbildning och utveckling.", pattern: "\\bUbuntu\\b", slug: "ubuntu" },
          { term: "terminal", def: "Textbaserat gränssnitt för att köra kommandon direkt i systemet.", pattern: "\\bterminal(en)?\\b", slug: "terminal" },
          { term: "filsystem", def: "Struktur för hur filer och mappar organiseras på en dator.", pattern: "\\bfilsystem(et)?\\b", slug: "filsystem" },
          { term: "rotkatalog", def: "Basen i Linuxfilsystemet där allt annat ligger under.", pattern: "\\brotkatalog(en)?\\b", slug: "rotkatalog" },
          { term: "/home", def: "Plats för användarnas personliga filer och mappar.", pattern: "/home", slug: "home" },
          { term: "/etc", def: "System- och programkonfigurationer.", pattern: "/etc", slug: "etc" },
          { term: "/var", def: "Loggar och variabel data som ändras ofta.", pattern: "/var", slug: "var" },
          { term: "pwd", def: "Visar nuvarande katalog (var du är).", pattern: "\\bpwd\\b", slug: "pwd" },
          { term: "ls", def: "Listar filer och mappar i en katalog.", pattern: "\\bls\\b", slug: "ls" },
          { term: "cd", def: "Byter katalog (navigerar i filsystemet).", pattern: "\\bcd\\b", slug: "cd" },
          { term: "mkdir", def: "Skapar en ny mapp.", pattern: "\\bmkdir\\b", slug: "mkdir" },
          { term: "rmdir", def: "Tar bort en tom mapp.", pattern: "\\brmdir\\b", slug: "rmdir" },
          { term: "touch", def: "Skapar en tom fil eller uppdaterar en fil.", pattern: "\\btouch\\b", slug: "touch" },
          { term: "rm", def: "Tar bort filer (och mappar med flaggor).", pattern: "\\brm\\b", slug: "rm" },
          { term: "cat", def: "Visar filinnehåll direkt i terminalen.", pattern: "\\bcat\\b", slug: "cat" },
          { term: "less", def: "Läser filer sida för sida med scroll.", pattern: "\\bless\\b", slug: "less" },
          { term: "find", def: "Söker efter filer och mappar i katalogträd.", pattern: "\\bfind\\b", slug: "find" },
          { term: "grep", def: "Söker efter text i filer.", pattern: "\\bgrep\\b", slug: "grep" },
          { term: "Tab-komplettering", def: "Auto-kompletterar fil- och kommandonamn med Tab.", pattern: "Tab-komplettering", slug: "tab-komplettering" },
          { term: "chmod", def: "Ändrar filrättigheter (rwx).", pattern: "\\bchmod\\b", slug: "chmod" },
          { term: "chown", def: "Ändrar ägare och grupp för en fil.", pattern: "\\bchown\\b", slug: "chown" },
          { term: "rwx", def: "Rättigheter: read, write, execute (läsa, skriva, köra).", pattern: "\\brwx\\b", slug: "rwx" },
          { term: "sudo", def: "Kör kommando med administrativa rättigheter.", pattern: "\\bsudo\\b", slug: "sudo" }
        ];

        var patterns = glossary.map(function (g) { return g.pattern; });
        var re = new RegExp("(" + patterns.join("|") + ")", "gi");
        var byTerm = {};
        glossary.forEach(function (g) {
          byTerm[g.term.toLowerCase()] = g;
        });

        function slugifyTerm(s) {
          return s
            .toLowerCase()
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "")
            .replace(/[^a-z0-9]+/g, "-")
            .replace(/^-+|-+$/g, "");
        }

        function wrapNode(textNode) {
          var text = textNode.nodeValue;
          if (!re.test(text)) return;
          re.lastIndex = 0;

          var frag = document.createDocumentFragment();
          var last = 0;
          var m;
          while ((m = re.exec(text)) !== null) {
            var match = m[0];
            var start = m.index;
            var end = start + match.length;
            if (start > last) {
              frag.appendChild(document.createTextNode(text.slice(last, start)));
            }

            var key = match.toLowerCase();
            var entry = byTerm[key];
            if (!entry) {
              for (var i = 0; i < glossary.length; i++) {
                var testRe = new RegExp("^" + glossary[i].pattern + "$", "i");
                if (testRe.test(match)) { entry = glossary[i]; break; }
              }
            }

            if (entry) {
              var link = document.createElement("a");
              link.className = "glossary-term";
              link.setAttribute("data-tip", entry.def);
              link.href = "{{ '/termlista/' | relative_url }}#term-" + entry.slug;
              link.textContent = match;
              frag.appendChild(link);
            } else {
              frag.appendChild(document.createTextNode(match));
            }

            last = end;
          }
          if (last < text.length) {
            frag.appendChild(document.createTextNode(text.slice(last)));
          }
          textNode.parentNode.replaceChild(frag, textNode);
        }

        var allowedHeadings = [
          "Fakecaptcha",
          "FakeError",
          "Initial Access",
          "Stoppa FakeCaptcha innan det händer",
          "Är domänen legitim? Snabb koll",
          "Tricks hackarna har använt sig av",
          "Konsekvenserna",
          "Introduktion",
          "Terminalen i Ubuntu",
          "Filsystem i Linux",
          "Viktiga kommandon",
          "Navigering och sök",
          "Behörigheter och ägarskap",
          "Uppgift",
          "Referenser"
        ];

        var headings = Array.prototype.slice.call(post.querySelectorAll("h2"));
        headings = headings.filter(function (h) {
          return allowedHeadings.indexOf(h.textContent.trim()) !== -1;
        });
        var toc = document.querySelector(".toc-links");
        if (toc && headings.length) {
          headings.forEach(function (h, idx) {
            if (!h.id) h.id = "section-" + (idx + 1);
            var a = document.createElement("a");
            a.href = "#" + h.id;
            a.textContent = h.textContent;
            a.dataset.target = h.id;
            toc.appendChild(a);
          });
        }

        function wrapSections() {
          if (!headings.length) return;
          headings.forEach(function (h) {
            var section = document.createElement("section");
            section.className = "post-section";
            h.parentNode.insertBefore(section, h);
            section.appendChild(h);
            var next = h.nextSibling;
            while (next && !(next.nodeType === 1 && /H2/.test(next.nodeName))) {
              var move = next;
              next = next.nextSibling;
              section.appendChild(move);
            }
          });
        }

        wrapSections();

        if (toc && headings.length) {
          var tocLinks = toc.querySelectorAll("a");
          tocLinks.forEach(function (link) {
            link.addEventListener("click", function () {
              tocLinks.forEach(function (l) { l.classList.remove("active"); });
              link.classList.add("active");
            });
          });
          var observer = new IntersectionObserver(function (entries) {
            entries.forEach(function (entry) {
              if (!entry.isIntersecting) return;
              var id = entry.target.id;
              tocLinks.forEach(function (l) {
                l.classList.toggle("active", l.dataset.target === id);
              });
            });
          }, { rootMargin: "-30% 0px -60% 0px", threshold: 0.1 });
          headings.forEach(function (h) { observer.observe(h); });
        }

        var walker = document.createTreeWalker(
          post,
          NodeFilter.SHOW_TEXT,
          {
            acceptNode: function (node) {
              if (!node.nodeValue || !node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
              var parent = node.parentNode;
              if (!parent) return NodeFilter.FILTER_REJECT;
              var tag = parent.nodeName;
              if (/(SCRIPT|STYLE|CODE|PRE|A|TEXTAREA|KBD|H1|H2|H3|H4|H5|H6)/.test(tag)) return NodeFilter.FILTER_REJECT;
              return NodeFilter.FILTER_ACCEPT;
            }
          }
        );

        var nodes = [];
        while (walker.nextNode()) nodes.push(walker.currentNode);
        nodes.forEach(wrapNode);
      })();
    </script>
    {% if page.title == "Introduktion till Linux terminal och filsystem i Ubuntu" %}
    <script>
      (function () {
        var overlay = document.getElementById("linux-quiz-overlay");
        if (!overlay) return;

        var progressEl = document.getElementById("linux-quiz-progress");
        var questionEl = document.getElementById("linux-quiz-question");
        var optionsEl = document.getElementById("linux-quiz-options");
        var feedbackEl = document.getElementById("linux-quiz-feedback");
        var doneEl = document.getElementById("linux-quiz-done");
        var closeBtn = document.getElementById("linux-quiz-close");

        var questions = [
          {
            q: "Vad gör chmod?",
            options: [
              { text: "Ändrar filrättigheter (rwx)", ok: true },
              { text: "Byter filägare", ok: false },
              { text: "Söker efter filer", ok: false }
            ]
          },
          {
            q: "Vilket kommando byter katalog?",
            options: [
              { text: "cd", ok: true },
              { text: "pwd", ok: false },
              { text: "ls", ok: false }
            ]
          },
          {
            q: "Vilket kommando söker efter text i filer?",
            options: [
              { text: "grep", ok: true },
              { text: "find", ok: false },
              { text: "touch", ok: false }
            ]
          },
          {
            q: "Vad betyder r i rwx?",
            options: [
              { text: "read", ok: true },
              { text: "run-as-root", ok: false },
              { text: "rename", ok: false }
            ]
          }
        ];

        var current = 0;
        var shown = false;

        function setOpen(isOpen) {
          overlay.hidden = !isOpen;
          document.body.classList.toggle("quiz-open", isOpen);
        }

        function renderQuestion() {
          if (current >= questions.length) {
            progressEl.textContent = "Klart";
            questionEl.textContent = "Bra jobbat, du klarade quizen.";
            optionsEl.innerHTML = "";
            feedbackEl.textContent = "";
            feedbackEl.className = "quiz-feedback";
            doneEl.hidden = false;
            return;
          }

          var item = questions[current];
            progressEl.textContent = "Fråga " + (current + 1) + " av " + questions.length;
          questionEl.textContent = item.q;
          optionsEl.innerHTML = "";
          feedbackEl.textContent = "";
          feedbackEl.className = "quiz-feedback";
          doneEl.hidden = true;

          item.options.forEach(function (opt) {
            var btn = document.createElement("button");
            btn.type = "button";
            btn.className = "quiz-option-btn";
            btn.textContent = opt.text;
            btn.addEventListener("click", function () {
              if (opt.ok) {
                feedbackEl.textContent = "Rätt svar. Vidare till nästa.";
                feedbackEl.className = "quiz-feedback ok";
                window.setTimeout(function () {
                  current += 1;
                  renderQuestion();
                }, 650);
                return;
              }
              feedbackEl.textContent = "Fel svar. Försök igen.";
              feedbackEl.className = "quiz-feedback bad";
            });
            optionsEl.appendChild(btn);
          });
        }

        function maybeShowQuiz() {
          if (shown) return;
          var nearBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 120;
          if (!nearBottom) return;
          shown = true;
          current = 0;
          renderQuestion();
          setOpen(true);
          window.removeEventListener("scroll", maybeShowQuiz);
        }

        closeBtn.addEventListener("click", function () {
          setOpen(false);
        });

        window.addEventListener("scroll", maybeShowQuiz, { passive: true });
        maybeShowQuiz();
      })();
    </script>
    {% endif %}
  </body>
</html>

